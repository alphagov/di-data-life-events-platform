# Vulnerability management and suppression

## Where do they come from?

Our findings for Security Hub come from 3 separate sources:

1. AWS ECR (our container registry) has enhanced continuous scanning set up, so each time a new image is pushed, or once
   a day for existing images, our images are scanned for vulnerabilities. These vulnerabilities are then sent to
   Security Hub via Inspector.
2. AWS Config allows for scanning of our current infrastructure setup. It checks our infrastructure to see whether it is
   compliant against rules defined by us in terraform and predefined by AWS. This is a combination of rules that we are
   specifying to be in compliance with NCSC Cloud Security Principals guidance, as well as some rules that checks us
   against AWS Security Hub controls that we have subscribed to.
3. SecurityHub does some of its own scanning of infrastructure.

## Where are they shown?

All the vulnerabilities will be listed in our Security Hub findings in AWS. This is
found [here](https://eu-west-2.console.aws.amazon.com/securityhub/home?region=eu-west-2#/findings?search=Region%3Deu-west-2%26WorkflowStatus%3D%255Coperator%255C%253AEQUALS%255C%253ANEW%26WorkflowStatus%3D%255Coperator%255C%253AEQUALS%255C%253ANOTIFIED%26RecordState%3D%255Coperator%255C%253AEQUALS%255C%253AACTIVE).

For these vulnerabilities, we should be either be solving them, or suppressing them if we believe them not to be an
issue for our use case.

## How to solve them?

If you click the title in the findings table, a side panel shows up with some extra details for the finding.

If this is a SecurityHub finding and not an issue with an image, there will be an expandable section
called `Remediation` which contains a link on how to solve this specific issue.

If this is an Inspector finding, the Remediation section will not contain anything helpful, and instead the
vulnerability will need to be investigated and solved or suppressed after that. The `Vulnerability details` section
contains a link to the vulnerability details from whichever vulnerability database it was reported in.

## How to suppress them?

We have programmatic suppression of our Security Hub findings in our codebase, to allow for a good management and
awareness of what has been suppressed. This list of suppressions is stored
in `ci/updata_securityhub_suppressions/suppressions.yml` and uploaded by a GitHub workflow. The format of the
suppressions in that file is:

- The key of the item is the Title of the finding
- The resources is a list of resources (matched by regex) that this suppression for this title will apply to
- The notes is a string to add to these suppressions for context or to mark the ticket tracking it
